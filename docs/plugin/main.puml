@startuml

title Main class diagram of the plugin

package __init__ {
    class StaticInit {
        +{static} pressure_level_cache
        +{static} bl_info
        +{static} pstd_path
        +{static} ui_elements
        +{static} run(op, context)
        +{static} draw_impulse_response()
        +{static} draw_colorbar()
        +{static} get_subdomain_vis(ob, subdomain, frame, cache=True)
        +{static} get_domain_visses(ob, frame, cache=True)
        +{static} draw_pressure_levels()
        +{static} update_baked_domains(scn)
        +{static} draw_domain_mesh()
        +{static} register()
        +{static} unregister()
    }
}

package store {
    class store.data {
        +{static}store
        +simulation_running
        +status_message
        +simulation_process
        +current_simulation_output_dir
        +__getattr__(k)
        +__setattr__(k, v)
    }

    note "Data storage for plugin wide variables" as NoteDataStore
    NoteDataStore .. store.data
}

package data {
    class PickleStream {
        +__init__(f)
        +read(n)
        +readLine()
        +get()
    }

    class Listener{
        +{static} ob_to_listener
        +__init__(receiver)
        -getFromObj(arg)
        -closeAll()
        +try_open()
        +read()
    }

    class DomainInfo {
        +__init__(pstd_data=None, ll=None)
        +{static} restore(str)
    }

    class DomainInfo.SubDomainInfo {
        +__init__(di)
        +{static} restore(data)
    }

    class StaticData {
        +{static} read_pressure_level_data(dir, id, frame)
    }
}

package enums {
    enum S {
        +BOUNDARY_ABSORPTION
        +BOUNDARY_LOCALLY_REACTING
    }

    enum VisualisationType {
        +PLAIN
        +BOUNDARY
        +SUBDOMAIN
        +LISTENER
        +BAKED_SUBDOMAIN
    }
}

package bmesh {
    class Staticbmesh {
        +{static} layer(bm, type, name)
        +{static} update(me, type, name, v)
        +{static} updater(type, bm_name, scn_name)
    }
}

package i18n {
    class i18n {
        +__init__(lang)
        +__getitem__(k)
    }
}

package Mesh {
    class Mesh {
        +{static} error_code
        +__init__(me)
        +is_bmesh()
        +vertices()
        +polygons()
        +test_NON_ORTHO()
        +test_NON_2D()
        +test_NON_QUAD()
        +validate()
        +get_bmesh()
        +get_bbox(scaling_component = None)
        +get_domains(nm, scaling_component)
    }
}

package ops {
    note "User Operations" as noteOps

    class SaveImpulseResponse {
        +{static}bl_idname
        +{static}bl_label
        +{static}filename_ext
        +{static}filter_glob
        +{static}setting_normalize
        +{static}setting_filetype
        +execute(context)
        -poll(context)
    }

    class BakeSimulation {
        +{static}get_domain_visses
        +{static}bl_idname
        +{static}bl_label
        +execute(context)
        -poll(context)
    }

    class StartSimulation {
        -{static}run
        +{static}bl_idname
        +{static}bl_label
        +{static}original_label
        +{static}alternative_label
        +{static}filename_ext
        +{static}filter_glob
        +{static}filepath
        +{static}check_existing
        +invoke(context)
        +execute(context)
    }

    class StopSimulation {
        +{static}bl_idname
        +{static}bl_label
        +invoke(context)
    }

    class ClearSimulationData {
        +{static}bl_idname
        +{static}bl_label
        +execute(context)
        -poll(context)
    }

    class FramesAvailableTimer {
        +{static}bl_idname
        +{static}bl_label
        +{static}is_running
        -{static}timer
        +modal(context, events)
        +execute(context)
        +cancel(context)
    }
}

package props {
    class SimulationResultPathList {
        +path
    }

    class StaticProps {
        +{static} STAND_ALONE
        +{static} default_python_path
        +{static} pstd_config_fn
        +{static} DEFAULT_GRID_SPACING
        +{static} DEFAULT_SOUND_SPEED
        +{static} grid_spacing_to_max_freq
        +{static} make_prop_updater(n1, b2, f)
        +{static} chain(*args)
        +{static} update_pstd_ini_file(key, value, section)
        +{static} get_from_pstd_ini_file(key, section)
        +{static} apply()
    }
}

package ui {
    class MenuItemHandler {
        +func
        +attachment
        +__init__(attachment, opname, icon, text)
        +register()
        +unregister()
    }
    class ImpulseResponseMenuItemHandler{
        +__init__()
    }
    class SettingsPanel {
        +{static}bl_label
        +{static}bl_idname
        +{static}bl_space_type
        +{static}bl_region_type
        +{static}bl_context

        +draw(context)
    }

    note "user interface" as noteUi
}

package visualization {
    class StaticVisualization {
        +{static} VISMAT_NAME
        +{static} linear_scale(max_value)
    }

    class ColorMap {
        +__call__(v)
    }

    class ColorMapHot {
        +f(v)
    }

    class Grid {
        +{static}db_scale
        +{static}cur_frame
        +{static}matrix_key
        +{static}invalidation
        +{static}dbs_colors
        +__init__(w, h, x, y, sx, sy)
        +update(fr, z)
        +update_colors()
        +move(mat)
        +draw()
        +to_object(parent_name, subdomain_info, ob)
        +{static} from_subdomain_data(data)
    }

    class Domain {
        +{static} draw(ob, me, d)
    }

    class ColorBar {
        +{static} draw(rw, rh, dbs)
    }

    class ImpulseResponse {
        +{static} draw(r1)
    }

    class DrawHandler {
        +__init__(area_type, callback)
        +register()
        +unregister()
    }

    class Handler {
        +__init__(area_type, callback)
        +register()
        +unregister()
    }
}

package blender {
    note "blender classes" as blender

    package bpy {
        package types {
            class Operator
            class Panel
        }
    }

    package bpy_extras {
        package io_utils {
            class ExportHelper
        }
    }

    package _bmesh {
        class BMesh
    }

}

note "Class with string constants" as NoteRename
NoteRename .. S

DomainInfo "1" *-- "*" DomainInfo.SubDomainInfo

Mesh "1" *-- "1" BMesh


SaveImpulseResponse --|> Operator
SaveImpulseResponse --|> ExportHelper
BakeSimulation --|> Operator
StartSimulation --|> Operator
StopSimulation --|> Operator
ClearSimulationData --|> Operator
FramesAvailableTimer --|> Operator

ImpulseResponseMenuItemHandler --|> MenuItemHandler
SettingsPanel --|> Panel

ColorMapHot --|> ColorMap

store.data *-- ColorMapHot

@enduml